"use strict";const urlCash="wss://ws.blockchain.info/bch/inv",urlCore="wss://ws.blockchain.info/inv",urlCors="http://cors-proxy.htmldriven.com/?url=",urlBtc="api.btc.com/v3/",urlBlockchainInfo="https://api.blockchain.info/",urlCoinMarketCap="https://api.coinmarketcap.com/v1/ticker/",socketCash=new WebSocket(urlCash),socketCore=new WebSocket(urlCore),canvas=document.getElementById("renderCanvas"),ctx=canvas.getContext("2d"),cashPoolInfo=document.getElementById("cash-pool"),corePoolInfo=document.getElementById("core-pool"),cashEta=document.getElementById("cash-eta"),coreEta=document.getElementById("core-eta"),confirmedNotify=document.getElementById("confirmed-notify"),confirmedAmount=document.getElementById("confirmed-amount"),cashAddress=document.getElementById("cash-address-input"),coreAddress=document.getElementById("core-address-input"),speedSlider=document.getElementById("speedSlider"),volumeSlider=document.getElementById("volumeSlider"),page=document.getElementById("page"),transactionWrap=document.getElementById("tx-wrap"),transactionList=document.getElementById("transactions"),donationGoal=document.getElementById("donationGoal"),xhrBlockchain=new XMLHttpRequest,carCore=new Image,carMicroCash=new Image,carSmallCash=new Image,carSmallMedCash=new Image,carMediumCash=new Image,carLargeCash=new Image,carXLargeCash=new Image,carWhaleCash=new Image,carUserCash=new Image,carMicroCore=new Image,carSmallCore=new Image,carSmallMedCore=new Image,carMediumCore=new Image,carLargeCore=new Image,carXLargeCore=new Image,carWhaleCore=new Image,carUserCore=new Image,carLambo=new Image,carSpam=new Image,carSatoshiDice=new Image,carSegwit=new Image;let audioContext=null,gainNode=null,audioMotorcycle=null,audioCar=null,audioDiesel=null,audioSemi=null,audioMercy=null,audioRide=null,audioChaChing=null,audioWoohoo=null,audioSpam=null,audioAllSpam=null,WIDTH=null,HEIGHT=null,SINGLE_LANE=HEIGHT/14,SPEED=8,SPEED_MODIFIER=0,VOLUME=0.5,PRICE_BCH=0,PRICE_BTC=0,DONATION_GOAL=2,TX_MICRO=10,TX_SMALL=1e3,TX_SMALL_MED=1e4,TX_MEDIUM=1e5,TX_LARGE=5e5,TX_WHALE=1e6,requestID=null,isVisible=!0,konamiActive=!1,isCashMuted=!1,isCoreMuted=!1,txCash=[],txCore=[];socketCash.onopen=()=>{socketCash.send(JSON.stringify({op:"unconfirmed_sub"})),socketCash.send(JSON.stringify({op:"blocks_sub"}))},socketCore.onopen=()=>{socketCore.send(JSON.stringify({op:"unconfirmed_sub"})),socketCore.send(JSON.stringify({op:"blocks_sub"}))},socketCash.onmessage=d=>{let e=JSON.parse(d.data);if("utx"==e.op){let f=parseInt(cashPoolInfo.textContent.replace(/\,/g,""));cashPoolInfo.textContent=formatWithCommas(f+1),newTX(!0,e.x)}else blockNotify(e.x,!0)},socketCore.onmessage=d=>{let e=JSON.parse(d.data);if("utx"==e.op){let f=parseInt(corePoolInfo.textContent.replace(/\,/g,""));corePoolInfo.textContent=formatWithCommas(f+1),e.x.inputs.forEach(g=>{120>JSON.stringify(g.script).length&&(e.x.sw=!0)}),newTX(!1,e.x)}else blockNotify(e.x,!1)};function init(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,window.addEventListener("load",resize,!1),window.addEventListener("resize",resize,!1),carMicroCash.src="assets/sprites/bch-micro.png",carSmallCash.src="assets/sprites/bch-small.png",carSmallMedCash.src="assets/sprites/bch-small-med.png",carMediumCash.src="assets/sprites/bch-medium.png",carLargeCash.src="assets/sprites/bch-large.png",carXLargeCash.src="assets/sprites/bch-xlarge.png",carWhaleCash.src="assets/sprites/bch-whale.png",carUserCash.src="assets/sprites/tx-taxi.png",carLambo.src="assets/sprites/lambo.png",carSatoshiDice.src="assets/sprites/dice.png",carMicroCore.src="assets/sprites/core-micro.png",carSmallCore.src="assets/sprites/core-small.png",carSmallMedCore.src="assets/sprites/core-small-med.png",carMediumCore.src="assets/sprites/core-medium.png",carLargeCore.src="assets/sprites/core-xlarge.png",carXLargeCore.src="assets/sprites/core-large.png",carWhaleCore.src="assets/sprites/core-whale.png",carUserCore.src="assets/sprites/tx-taxi.png",carSpam.src="assets/sprites/spam.png",carSegwit.src="assets/sprites/segwit.png",mobileCheck()&&($("input.overlay-switch")[0].checked=!0,$(".sign").fadeToggle("slow","linear"));let d=window.AudioContext||window.webkitAudioContext||!1;if(d){let e=window.AudioContext||window.webkitAudioContext;audioContext=new e,gainNode=audioContext.createGain()}else alert("Sorry, but the Web Audio API is not supported by your browser. Please, consider upgrading to the latest version or downloading Google Chrome or Mozilla Firefox");loadSound("assets/audio/motorcycle-lowergain.mp3","motorcycle"),loadSound("assets/audio/car-pass-lowergain.mp3","car"),loadSound("assets/audio/diesel-pass.mp3","diesel"),loadSound("assets/audio/semi-pass.mp3","semi"),loadSound("assets/audio/mercy-6s.mp3","mercy"),loadSound("assets/audio/ride-dirty-7s.mp3","ride"),loadSound("assets/audio/cha-ching.mp3","cha-ching"),loadSound("assets/audio/woohoo.mp3","woohoo"),loadSound("assets/audio/spam.mp3","spam"),loadSound("assets/audio/allspam.mp3","allspam"),updateMempoolData(),updatePriceData(),getCoreConfTime(urlBlockchainInfo+"charts/avg-confirmation-time?format=json&cors=true",xhrBlockchain),setTimeout(()=>{getDevDonations()},3e3),onReady(function(){show("page",!0),show("loading",!1)}),gainNode.gain.setTargetAtTime(VOLUME,audioContext.currentTime,0.015),requestID=requestAnimationFrame(animate)}function mobileCheck(){let d=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(d=!0)}(navigator.userAgent||navigator.vendor||window.opera),d}function updateMempoolData(){getPoolData(urlCors+"https://chain."+urlBtc+"tx/unconfirmed/summary",!1),getPoolData(urlCors+"https://bch-chain."+urlBtc+"tx/unconfirmed/summary",!0)}function updatePriceData(){getPriceData(urlCoinMarketCap+"bitcoin-cash/"),getPriceData(urlCoinMarketCap+"bitcoin/")}function getDevDonations(){let d=new XMLHttpRequest;d.onload=function(){if(4==this.readyState&&200==this.status){let f=JSON.parse(this.responseText);f=JSON.parse(f.body);let g=f.data.balance;g/=1e8,document.getElementById("donationAmt").textContent=g+" BCH",document.getElementById("donationTotal").textContent=DONATION_GOAL+" BCH",g=100*(g/DONATION_GOAL),donationGoal.setAttribute("value",g)}},d.open("GET",urlCors+"https://bch-chain."+urlBtc+"address/3MtCFL4aWWGS5cDFPbmiNKaPZwuD28oFvF",!0),d.send(null)}function getPriceData(d){let e=new XMLHttpRequest;e.onload=function(){if(4==this.readyState&&200==this.status){let f=JSON.parse(this.responseText);"BCH"==f[0].symbol?(PRICE_BCH=f[0].price_usd,document.getElementById("price_bch").textContent="USD $"+formatWithCommas(parseFloat(PRICE_BCH).toFixed(2))):(PRICE_BTC=f[0].price_usd,document.getElementById("price_btc").textContent="USD $"+formatWithCommas(parseFloat(PRICE_BTC).toFixed(2)))}},e.open("GET",d,!0),e.send(null)}function formatWithCommas(d){return d.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function blockNotify(d,e){let f=0,g="",h=0;if(e)g="BCH",f=parseInt(cashPoolInfo.textContent.replace(/\,/g,"")),h=d.nTx,cashPoolInfo.textContent=formatWithCommas(f-h);else{g="BTC",f=parseInt(corePoolInfo.textContent.replace(/\,/g,"")),h=d.nTx;let j=f/h/100;SPEED_MODIFIER=0.9<=j?0.9:1-j,corePoolInfo.textContent=formatWithCommas(f-h)}isVisible&&playSound(audioChaChing),confirmedAmount.textContent=h+" "+g,confirmedNotify.style.display="block",setTimeout(()=>{confirmedNotify.style.display="none",updateMempoolData(),updatePriceData()},4e3)}function getPoolData(d,e){let f=new XMLHttpRequest;f.onload=function(){if(4==this.readyState&&200==this.status){let g=JSON.parse(this.responseText);if(g=JSON.parse(g.body),e)cashPoolInfo.textContent=formatWithCommas(g.data.count);else if(corePoolInfo.textContent=formatWithCommas(g.data.count),0==SPEED_MODIFIER){let h=g.data.count/2400/100;SPEED_MODIFIER=0.9<=h?0.9:1-h}}},f.open("GET",d,!0),f.send(null)}function getCoreConfTime(d,e){e.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let f=JSON.parse(e.responseText);coreEta.textContent=f.period}},e.open("GET",d,!0),e.send(null)}function resize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,SINGLE_LANE=HEIGHT/14,canvas.width=WIDTH,canvas.height=HEIGHT}let vis=function(){let d,e,f={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(d in f)if(d in document){e=f[d];break}return function(g){return g&&document.addEventListener(e,g),!document[d]}}();vis(function(){vis()?(txCash=[],txCore=[],drawBackground(),requestAnimationFrame(animate),isVisible=!0):(cancelAnimationFrame(requestID),isVisible=!1)});function newTX(d,e){if(d){let f=Math.floor(8*Math.random())+1;createVehicle(d,txCash,e,f,!0)}else createVehicle(d,txCore,e,10,!1)}function addTxToList(d,e,f,g){let h=document.createElement("LI"),j="txid: "+e.substring(0,7)+"...\n";j+="value: "+f.toString().substring(0,9);let l=document.createTextNode(j);h.setAttribute("style","background-image: url("+g.src+");"),h.className=d?"txinfo-cash":"txinfo-core",h.appendChild(l),transactionList.prepend(h),50<transactionList.childNodes.length&&transactionList.removeChild(transactionList.childNodes[transactionList.childNodes.length-1])}function createVehicle(d,e,f,g,h){let j=!1,l=isUserTx(f),m=!1;h&&(j=isDonationTx(f),m=isSatoshiDiceTx(f));let n=0;f.out.forEach(r=>{let s=r.value/1e8;n+=s});let o=getCar(n,j,h,l,m,f.sw),p=SINGLE_LANE*(o.width/o.height),q=-p;0<e.length&&e.forEach(r=>{p>=r.x&&g==r.lane&&(q=r.x-p-20)}),e.push({type:d,id:f.hash,car:o,x:q,lane:g,h:SINGLE_LANE,w:p,valueOut:n,donation:j,userTx:l,isCash:h})}function getCar(d,e,f,g,h,j){if(!0==e)return SPEED=4,carLambo;if(j)return carSegwit;if(h)return carSatoshiDice;if(g)return f?carUserCash:carUserCore;let l=0;return(l=f?d*PRICE_BCH:d*PRICE_BTC,l<=TX_MICRO)?f?carMicroCash:carMicroCore:l>TX_MICRO&&l<=TX_SMALL?f?carSmallCash:carSmallCore:l>TX_SMALL&&l<=TX_SMALL_MED?f?carSmallMedCash:carSmallMedCore:l>TX_SMALL_MED&&l<=TX_MEDIUM?f?carMediumCash:carMediumCore:l>TX_MEDIUM&&l<=TX_LARGE?f?carLargeCash:carLargeCore:l>TX_LARGE&&l<=TX_WHALE?f?carXLargeCash:carXLargeCore:l>TX_WHALE?f?carWhaleCash:carWhaleCore:void 0}function addSounds(d){if(isVisible){if((d==carUserCash||d==carUserCore)&&playSound(audioWoohoo),d==carLambo){let e=Math.floor(2*Math.random())+1;1==e?playSound(audioMercy):playSound(audioRide)}d==carMicroCash||d==carMicroCore?playSound(audioMotorcycle):d==carMicroCash||d==carMicroCore||d==carSmallCash||d==carSmallCore||d==carSmallMedCash||d==carSmallMedCore?playSound(audioCar):d==carMediumCash||d==carMediumCore||d==carLargeCash||d==carLargeCore||d==carXLargeCash||d==carXLargeCore?(audioDiesel.playbackRate=1.4,playSound(audioDiesel)):d==carWhaleCash||d==carWhaleCore?(audioSemi.playbackRate=1.8,playSound(audioSemi)):d==carSpam&&playSound(audioSpam)}}function playSound(d){let e=audioContext.createBufferSource();e.buffer=d,e.playbackRate.value=speedSlider.value/100+0.5,e.connect(gainNode),gainNode.connect(audioContext.destination),e.start(0)}function loadSound(d,e){let f=new XMLHttpRequest;f.open("GET",d,!0),f.responseType="arraybuffer",f.onload=function(){audioContext.decodeAudioData(f.response,function(g){"motorcycle"==e?audioMotorcycle=g:"car"==e?audioCar=g:"diesel"==e?audioDiesel=g:"semi"==e?audioSemi=g:"mercy"==e?audioMercy=g:"ride"==e?audioRide=g:"cha-ching"==e?audioChaChing=g:"woohoo"==e?audioWoohoo=g:"spam"==e?audioSpam=g:"allspam"==e&&(audioAllSpam=g)})},f.send()}let isDonationTx=function(d){let e=d.out,f=!1;return e.forEach(g=>{let h=g.addr;("3ECKq7onkjnRQR2nNe5uUJp2yMsXRmZavC"==h||"3MtCFL4aWWGS5cDFPbmiNKaPZwuD28oFvF"==h)&&(f=!0,setTimeout(getDevDonations(),3e3))}),f},isSatoshiDiceTx=function(d){let e=d.out,f=!1;return e.forEach(g=>{let h=Object.keys(g);h.forEach(j=>{("1DiceoejxZdTrYwu3FMP2Ldew91jq9L2u"==j||"1Dice115YcjDrPM9gXFW8iFV9S3j9MtERm"==j||"1Dice1FZk6Ls5LKhnGMCLq47tg1DFG763e"==j||"1Dice1cF41TGRLoCTbtN33DSdPtTujzUzx"==j||"1Dice1wBBY22stCobuE1LJxHX5FNZ7U97N"==j||"1Dice2wTatMqebSPsbG4gKgT3HfHznsHWi"==j||"1Dice5ycHmxDHUFVkdKGgrwsDDK1mPES3U"==j||"1Dice7JNVnvzyaenNyNcACuNnRVjt7jBrC"==j||"1Dice7v1M3me7dJGtTX6cqPggwGoRADVQJ"==j||"1Dice81SKu2S1nAzRJUbvpr5LiNTzn7MDV"==j||"1Dice9GgmweQWxqdiu683E7bHfpb7MUXGd"==j)&&(f=!0)})}),f},isUserTx=function(d){let e=d.out,f=!1;return e.forEach(g=>{let h=Object.keys(g);h.forEach(j=>{(j==cashAddress.value||j==coreAddress.value)&&(f=!0)})}),f};function drawBackground(){ctx.clearRect(0,0,WIDTH,HEIGHT),ctx.fillStyle="#9EA0A3",ctx.setLineDash([6]),ctx.strokeStyle="#FFF",ctx.strokeRect(-2,1*SINGLE_LANE,WIDTH+3,SINGLE_LANE),ctx.strokeRect(-2,3*SINGLE_LANE,WIDTH+3,SINGLE_LANE),ctx.strokeRect(-2,5*SINGLE_LANE,WIDTH+3,SINGLE_LANE),ctx.strokeRect(-2,7*SINGLE_LANE,WIDTH+3,SINGLE_LANE),ctx.setLineDash([0]),ctx.strokeStyle="#3F3B3C",ctx.strokeRect(-2,8*SINGLE_LANE,WIDTH+3,SINGLE_LANE),ctx.setLineDash([6]),ctx.strokeStyle="#FFF",ctx.strokeRect(-2,10*SINGLE_LANE,WIDTH+3,SINGLE_LANE)}function drawVehicles(d){let e=null,f=null,g=null;d.forEach(function(h){if(e=!h.isCash&&konamiActive?carSpam:h.car,h.x>-e.width-SPEED-20){if(h.isPlaying||(addTxToList(h.isCash,h.id,h.valueOut,e),(h.isCash&&!isCashMuted||!h.isCash&&!isCoreMuted)&&addSounds(e)),h.isPlaying=!0,f=h.lane*SINGLE_LANE-SINGLE_LANE,g=SINGLE_LANE*(e.width/e.height),h.car==carSegwit){h.y||(h.y=f),h.d||(h.d=0.3);let m=9*SINGLE_LANE-SINGLE_LANE/4,n=9*SINGLE_LANE+SINGLE_LANE/4;h.y>n&&(h.d=-0.3),h.y<m&&(h.d=0.3),h.y+=h.d,f=h.y}ctx.drawImage(e,h.x,f,g,SINGLE_LANE)}h.x+=h.isCash?SPEED:SPEED*SPEED_MODIFIER})}function removeVehicles(){txCash.forEach(function(d,e,f){d.donation&&(SPEED=8),d.x>WIDTH+100&&f.splice(e,1)}),txCore.forEach(function(d,e,f){d.x>WIDTH+100&&f.splice(e,1)})}function animate(){requestID=requestAnimationFrame(animate),drawBackground(),drawVehicles(txCash),drawVehicles(txCore),removeVehicles()}speedSlider.oninput=function(){let d=16*(this.value/100);SPEED=d},volumeSlider.oninput=function(){let d=this.value/100;VOLUME=d,gainNode.gain.setTargetAtTime(VOLUME,audioContext.currentTime,0.015)},$("#tx-list-button").click(function(){transactionWrap.style.right="0%"==transactionWrap.style.right?"-151px":"0%"}),$("input.cash-mute").change(function(){isCashMuted=this.checked?!isCashMuted:!isCashMuted}),$(".nav .legend").hover(function(){$(this).find("i").toggleClass("fa-car fa-truck")}),$("input.overlay-switch").change(function(){this.checked?$(".sign").fadeToggle("slow","linear"):$(".sign").fadeToggle("slow","linear")}),$(".nav .search").click(function(){$(this).find("i").toggleClass("fa-search fa-eye")}),$(".tx-list-link").click(function(){$(this).find("i").toggleClass("fa-list fa-close")}),$(".nav .settings").hover(function(){$(this).find("i").toggleClass("fa-cog fa-cogs")}),$(".nav .donate").hover(function(){$(this).find("i").toggleClass("fa-heart fa-money")}),$("input.core-mute").change(function(){isCoreMuted=this.checked?!isCoreMuted:!isCoreMuted}),$(".nav a").on("click",function(){$("#"+$(this).data("modal")).css("display","block")}),$(".nav a.donate").on("click",function(){$("#"+$(this).data("modal")).toggleClass("donate donate-off")}),$(".close").on("click",function(){$(".modal").hide()});let easter_egg=new Konami(function(){!1==konamiActive||null==konamiActive?(playSound(audioAllSpam),konamiActive=!0,$(".core-mode").fadeToggle("slow","linear")):!0==konamiActive&&(konamiActive=!1,$(".core-mode").fadeToggle("slow","linear"))});window.onclick=function(d){$(d.target).hasClass("modal")&&$(".modal").hide()};function onReady(d){let f=window.setInterval(function(){document.getElementsByTagName("body")[0]!==void 0&&(window.clearInterval(f),d.call(this))},1500)}function show(d,e){document.getElementById(d).style.display=e?"block":"none"}init();